language: cpp

compiler:
  - clang
  - gcc

before_install:
  # g++4.8.1
  - if [ "$CXX" == "g++" ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; fi

  # clang 3.4
  - if [ "$CXX" == "clang++" ]; then sudo add-apt-repository -y ppa:h-rayflood/llvm; fi

  - sudo apt-get update -qq

  # to prevent IPv6 being used for APT
  - sudo bash -c "echo 'Acquire::ForceIPv4 \"true\";' > /etc/apt/apt.conf.d/99force-ipv4"
  # The ultimate one-liner setup for NeuroDebian repository
  - bash <(wget -q -O- http://neuro.debian.net/_files/neurodebian-travis.sh)
  # But we actually want -devel repository just to get matio backport
  - sudo sed -ie 's,neuro.debian.net/debian ,neuro.debian.net/debian-devel ,g' /etc/apt/sources.list.d/neurodebian.sources.list
  - sudo apt-get update
  # Just to get information about available versions
  - apt-cache policy libmatio-dev

install:
  # g++4.8.1
  - if [ "$CXX" = "g++" ]; then sudo apt-get install -qq g++-4.8; fi
  - if [ "$CXX" = "g++" ]; then export CXX="g++-4.8"; fi

  # clang 3.4
  - if [ "$CXX" == "clang++" ]; then sudo apt-get install --allow-unauthenticated -qq clang-3.4; fi
  - if [ "$CXX" == "clang++" ]; then export CXX="clang++-3.4"; fi

  - sudo apt-get update
  - sudo apt-get install doxygen python-numpy swig python-dev libatlas-base-dev libvtk5-dev libtiff4-dev libmatio-dev libhdf5-serial-dev
  - wget https://s3.amazonaws.com/biibinaries/thirdparty/cmake-3.0.2-Linux-64.tar.gz
  - tar -xzf cmake-3.0.2-Linux-64.tar.gz
  - sudo cp -fR cmake-3.0.2-Linux-64/* /usr
  - rm -rf cmake-3.0.2-Linux-64
  - rm cmake-3.0.2-Linux-64.tar.gz
  - mkdir build; cd build; cmake
              -DATLAS_INCLUDE_PATH:PATH=/usr/include/atlas
              -DBUILD_SHARED:BOOL=ON
              -DBUILD_TESTING:BOOL=ON
              -DPYTHON_WRAP:BOOL=ON
              -DUSE_VTK:BOOL=OFF
              -DUSE_ATLAS:BOOL=ON
              -DUSE_SYSTEM_MATIO:BOOL=ON
              -DUSE_SYSTEM_hdf5:BOOL=ON
              -DCMAKE_SKIP_RPATH:BOOL=OFF
              ..
  - make

script:
  - $CXX --version
  - ctest -V
